<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A bit crazy journal - v1.0</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#6366f1', dark: '#4f46e5' },   // Indigo
                        win: { DEFAULT: '#10b981', dark: '#059669' },       // Emerald
                        loss: { DEFAULT: '#ef4444', dark: '#dc2626' },      // Red
                        background: { light: '#f8fafc', dark: '#0f172a' },  // Slate-50 / Slate-900
                        surface: { light: '#ffffff', dark: '#1e293b' },     // White / Slate-800
                        text: {
                            main: { light: '#0f172a', dark: '#f8fafc' },
                            muted: { light: '#64748b', dark: '#94a3b8' }
                        },
                        border: { light: '#e2e8f0', dark: '#334155' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'], // Good for numbers
                    }
                }
            }
        }
    </script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: theme('colors.background.light');
            color: theme('colors.text.main.light');
        }

        .dark body {
            background-color: theme('colors.background.dark');
            color: theme('colors.text.main.dark');
        }

        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body
    class="h-screen w-screen overflow-hidden flex text-text-main-light dark:text-text-main-dark transition-colors duration-300">

    <!-- SIDEBAR (Fixed) -->
    <aside
        class="w-20 md:w-64 bg-surface-light dark:bg-surface-dark border-r border-border-light dark:border-border-dark flex flex-col justify-between shrink-0 z-20">
        <!-- Logo -->
        <div
            class="w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center overflow-hidden border border-primary/20">
            <img src="logo.png?v=2" class="w-full h-full object-cover" alt="Logo">
        </div>
        <span class="ml-3 font-black text-lg tracking-tight hidden md:block leading-tight"><span
                id="sidebar-username">Turtle Trader</span><br><span id="sidebar-journal-title"
                class="text-xs font-bold text-text-muted-light">tortol trader journal</span></span>
        </div>
        <div id="admin-badge"
            class="hidden px-2 py-0.5 bg-amber-500 text-white text-[10px] font-black rounded ml-4 uppercase tracking-tighter">
            Admin</div>

        <!-- Navigation -->
        <nav class="flex-1 py-6 flex flex-col gap-2 px-2 md:px-4">
            <!-- Core Features -->
            <button onclick="app.navigate('dashboard')" id="nav-dashboard"
                class="nav-item active flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl bg-slate-100 dark:bg-slate-700/50 text-indigo-500 dark:text-indigo-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all shadow-sm">
                <span class="material-symbols-outlined">dashboard</span>
                <span class="hidden md:block font-semibold text-sm">Dashboard</span>
            </button>
            <button onclick="app.navigate('calendar')" id="nav-calendar"
                class="nav-item flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-indigo-400 dark:hover:text-indigo-400">
                <span class="material-symbols-outlined">calendar_month</span>
                <span class="hidden md:block font-semibold text-sm">Calendar</span>
            </button>
            <button onclick="app.navigate('journal')" id="nav-journal"
                class="nav-item flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-primary dark:hover:text-primary">
                <span class="material-symbols-outlined">menu_book</span>
                <span class="hidden md:block font-semibold text-sm">Tortol Trade Journal</span>
            </button>
            <button onclick="app.newEntry()" id="nav-entry"
                class="nav-item flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-primary dark:hover:text-primary">
                <span class="material-symbols-outlined">edit_square</span>
                <span class="hidden md:block font-semibold text-sm">Log Trade</span>
            </button>
            <button onclick="app.navigate('habits')" id="nav-habits"
                class="nav-item flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-indigo-400 dark:hover:text-indigo-400">
                <span class="material-symbols-outlined">checklist</span>
                <span class="hidden md:block font-semibold text-sm">Habit Tracker</span>
            </button>

            <!-- Extras Section -->
            <div class="hidden md:block pt-4 pb-2">
                <p
                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider px-2">
                    Extras</p>
            </div>

            <button onclick="app.navigate('calculator')" id="nav-calculator"
                class="nav-item flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-primary dark:hover:text-primary">
                <span class="material-symbols-outlined">calculate</span>
                <span class="hidden md:block font-semibold text-sm">Calculator</span>
            </button>
            <button onclick="app.navigate('simulator')" id="nav-simulator"
                class="nav-item flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-indigo-400 dark:hover:text-indigo-400">
                <span class="material-symbols-outlined">rocket_launch</span>
                <span class="hidden md:block font-semibold text-sm">Simulator</span>
            </button>

            <div class="border-t border-border-light dark:border-border-dark my-2"></div>

            <button onclick="app.manageInvites()" id="nav-invites"
                class="hidden flex items-center justify-center md:justify-start gap-3 p-3 rounded-xl bg-amber-100 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 hover:bg-amber-200 dark:hover:bg-amber-900/40 transition-all">
                <span class="material-symbols-outlined">person_add</span>
                <span class="hidden md:block font-semibold text-sm">Manage Invites</span>
            </button>
        </nav>

        <!-- User / Settings -->
        <div class="p-4 md:p-6">
            <button onclick="app.backupData()"
                class="w-full flex items-center justify-center md:justify-start gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-emerald-500 hover:text-emerald-600">
                <span class="material-symbols-outlined">save</span>
                <span class="hidden md:block font-semibold text-sm">Save Data</span>
            </button>
            <button onclick="app.toggleTheme()"
                class="w-full flex items-center justify-center md:justify-start gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark">
                <span class="material-symbols-outlined dark:hidden">dark_mode</span>
                <span class="material-symbols-outlined hidden dark:block">light_mode</span>
                <span class="hidden md:block font-semibold text-sm">Theme</span>
            </button>
            <button onclick="app.viewProfile()" id="nav-profile"
                class="w-full flex items-center justify-center md:justify-start gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-text-muted-light dark:text-text-muted-dark hover:text-indigo-400 dark:hover:text-indigo-400">
                <span class="material-symbols-outlined">account_circle</span>
                <span class="hidden md:block font-semibold text-sm">My Profile</span>
            </button>
            <button onclick="app.logout()"
                class="w-full flex items-center justify-center md:justify-start gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-loss">
                <span class="material-symbols-outlined">logout</span>
                <span class="hidden md:block font-semibold text-sm">Logout</span>
            </button>
        </div>
    </aside>

    <!-- CONTENT AREA (Scrollable) -->
    <main class="flex-1 flex flex-col min-w-0 bg-background-light dark:bg-background-dark max-h-screen">

        <!-- Header (Sticky) -->
        <header
            class="h-16 bg-surface-light/80 dark:bg-surface-dark/80 backdrop-blur-md border-b border-border-light dark:border-border-dark flex items-center justify-between px-8 sticky top-0 z-10">
            <h1 id="page-title" class="text-xl font-bold">Dashboard</h1>
            <div class="flex items-center gap-4">
            </div>
        </header>

        <!-- VIEW CONTAINER (Scrollable) -->
        <div id="views-container" class="flex-1 overflow-y-auto min-h-0 scroll-smooth p-4 md:p-8 relative">

            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section space-y-6 max-w-[1440px] mx-auto pb-20">
                <!-- ... existing dashboard content ... -->
                <!-- SHORTCUT TO HABITS -->
                <div class="grid grid-cols-1">
                    <button onclick="app.navigate('habits')"
                        class="bg-gradient-to-r from-indigo-600 to-violet-600 text-white p-4 rounded-xl shadow-lg shadow-indigo-500/20 flex items-center justify-between group hover:scale-[1.01] transition-transform">
                        <div class="flex items-center gap-3">
                            <span class="p-2 bg-white/20 rounded-lg material-symbols-outlined">checklist</span>
                            <div class="text-left">
                                <h4 class="font-bold">Habit Tracker</h4>
                                <p class="text-xs text-indigo-100">Maintain your discipline protocol.</p>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined group-hover:translate-x-1 transition-transform">arrow_forward</span>
                    </button>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">

                    <!-- Total Trades -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                                <span class="material-symbols-outlined text-info">format_list_numbered</span>
                            </div>
                        </div>
                        <p class="text-sm text-text-muted-light dark:text-text-muted-dark font-medium">Total Trades</p>
                        <h3 class="text-2xl font-black tracking-tight" id="dash-total-trades">0</h3>
                    </div>
                    <!-- Total PnL -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                                <span class="material-symbols-outlined text-primary">attach_money</span>
                            </div>
                            <span
                                class="text-xs font-bold bg-green-100 text-green-700 px-2 py-1 rounded-full">+12.5%</span>
                        </div>
                        <p class="text-sm text-text-muted-light dark:text-text-muted-dark font-medium">Net P&L</p>
                        <h3 class="text-2xl font-black tracking-tight" id="dash-net-pnl">$0.00</h3>
                    </div>

                    <!-- Win Rate -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                                <span class="material-symbols-outlined text-blue-500">pie_chart</span>
                            </div>
                        </div>
                        <p class="text-sm text-text-muted-light dark:text-text-muted-dark font-medium">Win Rate</p>
                        <h3 class="text-2xl font-black tracking-tight" id="dash-win-rate">0%</h3>
                    </div>

                    <!-- Profit Factor -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                                <span class="material-symbols-outlined text-purple-500">trending_up</span>
                            </div>
                        </div>
                        <p class="text-sm text-text-muted-light dark:text-text-muted-dark font-medium">Profit Factor</p>
                        <h3 class="text-2xl font-black tracking-tight" id="dash-profit-factor">0.00</h3>
                    </div>

                    <!-- Avg Trade -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                                <span class="material-symbols-outlined text-orange-500">show_chart</span>
                            </div>
                        </div>
                        <p class="text-sm text-text-muted-light dark:text-text-muted-dark font-medium">Avg Trade</p>
                        <h3 class="text-2xl font-black tracking-tight" id="dash-avg-trade">$0.00</h3>
                    </div>
                </div>

                <!-- Community Statistics & AI Insights (Admin/Analyst Only) -->
                <div id="community-stats-container" class="hidden mb-8 space-y-6">
                    <!-- Section Header -->
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-symbols-outlined text-primary">groups</span>
                        <h2 class="text-xl font-black tracking-tight text-text-main-light dark:text-text-main-dark">
                            Community Performance (Admin/Analyst)</h2>
                    </div>

                    <!-- Metrics Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Placeholder 1: Top Mistakes -->
                        <div
                            class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-sm border border-border-light dark:border-border-dark p-4 flex flex-col items-center justify-center text-center opacity-70 hover:opacity-100 transition-opacity">
                            <span class="material-symbols-outlined text-3xl text-loss mb-2">warning</span>
                            <h4
                                class="font-bold text-sm text-text-muted-light dark:text-text-muted-dark uppercase tracking-wide">
                                Top Community Mistake</h4>
                            <p class="text-lg font-black text-text-main-light dark:text-text-main-dark mt-1"
                                id="comm-top-mistake">N/A</p>
                            <span class="text-[10px] text-text-muted-light dark:text-text-muted-dark"
                                id="comm-mistake-stat">No data</span>
                        </div>
                        <!-- Placeholder 2: Best Trader -->
                        <div
                            class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-sm border border-border-light dark:border-border-dark p-4 flex flex-col items-center justify-center text-center opacity-70 hover:opacity-100 transition-opacity">
                            <span class="material-symbols-outlined text-3xl text-win mb-2">emoji_events</span>
                            <h4
                                class="font-bold text-sm text-text-muted-light dark:text-text-muted-dark uppercase tracking-wide">
                                Top Trader</h4>
                            <p class="text-lg font-black text-text-main-light dark:text-text-main-dark mt-1"
                                id="comm-top-trader">N/A</p>
                            <span class="text-[10px] text-text-muted-light dark:text-text-muted-dark"
                                id="comm-trader-stat">No data</span>
                        </div>
                        <!-- Placeholder 3: Favorite Setup -->
                        <div
                            class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-sm border border-border-light dark:border-border-dark p-4 flex flex-col items-center justify-center text-center opacity-70 hover:opacity-100 transition-opacity">
                            <span class="material-symbols-outlined text-3xl text-primary mb-2">favorite</span>
                            <h4
                                class="font-bold text-sm text-text-muted-light dark:text-text-muted-dark uppercase tracking-wide">
                                Most Winning Setup</h4>
                            <p class="text-lg font-black text-text-main-light dark:text-text-main-dark mt-1"
                                id="comm-win-setup">N/A</p>
                            <span class="text-[10px] text-text-muted-light dark:text-text-muted-dark"
                                id="comm-win-setup-stat">No data</span>
                        </div>
                        <!-- Placeholder 4: Top Loser Setup -->
                        <div
                            class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-sm border border-border-light dark:border-border-dark p-4 flex flex-col items-center justify-center text-center opacity-70 hover:opacity-100 transition-opacity">
                            <span class="material-symbols-outlined text-3xl text-loss mb-2">thumb_down</span>
                            <h4
                                class="font-bold text-sm text-text-muted-light dark:text-text-muted-dark uppercase tracking-wide">
                                Hardest Setup</h4>
                            <p class="text-lg font-black text-text-main-light dark:text-text-main-dark mt-1"
                                id="comm-loss-setup">N/A</p>
                            <span class="text-[10px] text-text-muted-light dark:text-text-muted-dark"
                                id="comm-loss-setup-stat">No data</span>
                        </div>
                    </div>

                    <!-- AI Insights Placeholder -->
                    <div id="ai-insights-container"
                        class="bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-xl border border-indigo-500/20 p-6 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 p-4 opacity-50 group-hover:opacity-80 transition-opacity">
                            <span class="material-symbols-outlined text-4xl text-indigo-500">auto_awesome</span>
                        </div>
                        <h3 class="font-bold text-indigo-600 dark:text-indigo-400 mb-2 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg">psychology</span> AI Market Insights
                        </h3>
                        <p class="text-sm text-text-main-light dark:text-text-main-dark max-w-2xl leading-relaxed">
                            <span class="font-bold">Weekly Summary:</span> The community has shown a tendency towards
                            early entries this week, resulting in a 15% increase in drawdown. Wait for confirmation
                            candles on the 15m timeframe to improve R:R.
                        </p>
                        <div class="mt-4 flex gap-2">
                            <span
                                class="text-[10px] font-bold bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 px-2 py-1 rounded">Pattern
                                Recognition</span>
                            <span
                                class="text-[10px] font-bold bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-1 rounded">Behavioral
                                Analysis</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Main PnL Chart (Full Width) -->
                    <div
                        class="lg:col-span-3 bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-lg">Cumulative P&L</h3>
                            <!-- Dynamic Filters -->
                            <div class="flex gap-2">
                                <button onclick="app.updateTimeFilter('1W')"
                                    class="filter-btn px-3 py-1 text-xs font-bold rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
                                    data-filter="1W">1W</button>
                                <button onclick="app.updateTimeFilter('1M')"
                                    class="filter-btn px-3 py-1 text-xs font-bold rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
                                    data-filter="1M">1M</button>
                                <button onclick="app.updateTimeFilter('3M')"
                                    class="filter-btn px-3 py-1 text-xs font-bold rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
                                    data-filter="3M">3M</button>
                                <button onclick="app.updateTimeFilter('YTD')"
                                    class="filter-btn px-3 py-1 text-xs font-bold rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
                                    data-filter="YTD">YTD</button>
                                <button onclick="app.updateTimeFilter('ALL')"
                                    class="filter-btn active px-3 py-1 text-xs font-bold rounded-lg bg-primary text-white shadow-md shadow-primary/20"
                                    data-filter="ALL">ALL</button>
                            </div>
                        </div>
                        <div class="h-64 w-full">
                            <canvas id="chart-pnl"></canvas>
                        </div>
                    </div>

                    <!-- NEW: Chart 2 - Loss Analysis (Bar Chart) -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Top Loss Reasons</h3>
                        <div class="h-48 w-full">
                            <canvas id="chart-loss-reasons"></canvas>
                        </div>
                    </div>

                    <!-- NEW: Chart 3 - Instrument Performance (Doughnut) -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Asset Class Performance</h3>
                        <div class="h-48 w-full flex justify-center">
                            <canvas id="chart-asset-class"></canvas>
                        </div>
                    </div>

                    <!-- NEW: Recent Trades List -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Recent Trades</h3>
                        <div class="overflow-y-auto max-h-48 no-scrollbar">
                            <table class="w-full text-sm text-left">
                                <tbody id="dashboard-recent-trades-body"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- NEW: Top Winners List -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Top Winners</h3>
                        <div class="overflow-y-auto max-h-48 no-scrollbar">
                            <table class="w-full text-sm text-left">
                                <thead
                                    class="text-xs text-text-muted-light dark:text-text-muted-dark border-b border-border-light dark:border-border-dark">
                                    <tr>
                                        <th class="pb-2">Symbol</th>
                                        <th class="pb-2 text-right">PnL</th>
                                    </tr>
                                </thead>
                                <tbody id="table-top-winners"
                                    class="divide-y divide-border-light dark:divide-border-dark"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- NEW: Top Losers List -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Top Losers</h3>
                        <div class="overflow-y-auto max-h-48 no-scrollbar">
                            <table class="w-full text-sm text-left">
                                <thead
                                    class="text-xs text-text-muted-light dark:text-text-muted-dark border-b border-border-light dark:border-border-dark">
                                    <tr>
                                        <th class="pb-2">Symbol</th>
                                        <th class="pb-2 text-right">PnL</th>
                                    </tr>
                                </thead>
                                <tbody id="table-top-losers"
                                    class="divide-y divide-border-light dark:divide-border-dark"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- NEW: Setup Performance -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Setup Performance</h3>
                        <div class="h-48 w-full">
                            <canvas id="chart-setups"></canvas>
                        </div>
                    </div>

                    <!-- NEW: Execution Success Rate -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Execution Analysis</h3>
                        <div class="h-48 w-full">
                            <canvas id="chart-execution"></canvas>
                        </div>
                    </div>

                    <!-- NEW: Timeframe Usage -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Timeframe Usage</h3>
                        <div class="h-48 w-full flex justify-center">
                            <canvas id="chart-timeframes"></canvas>
                        </div>
                    </div>
                </div>

            </div>

            <!-- VIEW: JOURNAL (List) -->
            <div id="view-journal" class="view-section hidden space-y-6 w-full max-w-full pb-20">
                <div class="flex flex-col md:flex-row justify-between gap-4 items-end">
                    <div>
                        <h2 class="text-3xl font-black tracking-tight" id="journal-view-title">Tortol Trader Journal
                        </h2>
                        <p class="text-text-muted-light dark:text-text-muted-dark">Full history of your trading
                            performance.</p>
                    </div>
                    <button onclick="app.newEntry()"
                        class="flex items-center gap-2 bg-primary hover:bg-primary-dark text-white px-5 py-2.5 rounded-lg font-bold shadow-lg shadow-primary/20 transition-all">
                        <span class="material-symbols-outlined">add</span>
                        Log New Trade
                    </button>
                </div>

                <!-- Journal Table Container -->
                <div
                    class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead
                                class="bg-slate-50 dark:bg-slate-800/50 text-text-muted-light dark:text-text-muted-dark uppercase text-xs font-semibold">
                                <tr>
                                    <th class="px-6 py-4">Date</th>
                                    <th class="px-6 py-4">Symbol</th>
                                    <th class="px-6 py-4">Side</th>
                                    <th class="px-6 py-4">Setup/Mistake</th>
                                    <th class="px-6 py-4">Image</th>
                                    <th class="px-6 py-4 text-right">P&L</th>
                                    <th class="px-6 py-4 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="journal-table-body" class="divide-y divide-border-light dark:divide-border-dark">
                                <!-- Dynamic Content -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination (Simple) -->
                    <div
                        class="p-4 border-t border-border-light dark:border-border-dark flex justify-between items-center">
                        <span class="text-sm text-text-muted-light dark:text-text-muted-dark" id="journal-count">0
                            trades</span>
                    </div>
                </div>
            </div>

            <!-- VIEW: CALCULATOR (Premium Redesign) -->
            <div id="view-calculator" class="view-section hidden w-full max-w-[1440px] mx-auto pb-20 fade-in">
                <!-- Page Header -->
                <div class="mb-8">
                    <h2 class="text-3xl font-black tracking-tight text-white flex items-center gap-3">
                        <span
                            class="p-2 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg shadow-lg shadow-indigo-500/30 text-white">
                            <span class="material-symbols-outlined">calculate</span>
                        </span>
                        Risk Calculator
                    </h2>
                    <p class="text-slate-400 mt-2 text-lg">Precision sizing for professional risk management.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <!-- LEFT COLUMN: INPUTS (Glass Panel) -->
                    <div class="lg:col-span-4 flex flex-col gap-6">
                        <div
                            class="bg-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-2xl relative overflow-hidden group">
                            <!-- Decor -->
                            <div
                                class="absolute -top-24 -right-24 w-48 h-48 bg-indigo-500/10 rounded-full blur-3xl pointer-events-none group-hover:bg-indigo-500/20 transition-all duration-700">
                            </div>

                            <h3
                                class="text-xs font-bold uppercase tracking-widest text-indigo-400 mb-6 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></span>
                                Trade Parameters
                            </h3>

                            <div class="space-y-6">
                                <!-- Account Balance -->
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center text-sm">
                                        <label class="font-medium text-slate-300">Account Balance</label>
                                        <div class="flex gap-2">
                                            <button
                                                onclick="document.getElementById('inputCapital').value=10000; app.calculator.calculate()"
                                                class="text-xs text-slate-500 hover:text-white transition-colors">10k</button>
                                            <button
                                                onclick="document.getElementById('inputCapital').value=50000; app.calculator.calculate()"
                                                class="text-xs text-slate-500 hover:text-white transition-colors">50k</button>
                                            <button
                                                onclick="document.getElementById('inputCapital').value=100000; app.calculator.calculate()"
                                                class="text-xs text-slate-500 hover:text-white transition-colors">100k</button>
                                        </div>
                                    </div>
                                    <div class="relative group/input">
                                        <span
                                            class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within/input:text-indigo-400 transition-colors">account_balance_wallet</span>
                                        <input type="number" id="inputCapital" value="10000"
                                            class="w-full bg-slate-950/50 border border-slate-700 rounded-xl h-12 pl-12 pr-4 text-white font-mono placeholder:text-slate-700 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all shadow-inner">
                                    </div>
                                </div>

                                <!-- Risk % -->
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center text-sm">
                                        <label class="font-medium text-slate-300">Risk per Trade</label>
                                        <span class="text-indigo-400 font-bold" id="labelRiskPercent">1.0%</span>
                                    </div>
                                    <input type="range" id="inputRiskSlider" min="0.25" max="5" step="0.25" value="1"
                                        class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500 hover:accent-indigo-400 transition-all">
                                    <div class="flex gap-2 justify-between">
                                        <button onclick="app.calculator.setRisk(0.5)"
                                            class="px-2 py-1 rounded bg-slate-800 border border-slate-700 text-xs text-slate-400 hover:text-white hover:border-indigo-500 hover:bg-slate-700 transition-all">0.5%</button>
                                        <button onclick="app.calculator.setRisk(1.0)"
                                            class="px-2 py-1 rounded bg-slate-800 border border-slate-700 text-xs text-slate-400 hover:text-white hover:border-indigo-500 hover:bg-slate-700 transition-all">1.0%</button>
                                        <button onclick="app.calculator.setRisk(2.0)"
                                            class="px-2 py-1 rounded bg-slate-800 border border-slate-700 text-xs text-slate-400 hover:text-white hover:border-indigo-500 hover:bg-slate-700 transition-all">2.0%</button>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <!-- Stop Loss -->
                                    <div class="space-y-2">
                                        <label class="font-medium text-slate-300 text-sm">Stop Loss %</label>
                                        <div class="relative group/input">
                                            <input type="number" id="inputStopLoss" value="2.0" step="0.1"
                                                class="w-full bg-slate-950/50 border border-slate-700 rounded-xl h-12 pl-4 pr-8 text-white font-mono focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all shadow-inner">
                                            <span
                                                class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs">%</span>
                                        </div>
                                    </div>
                                    <!-- R/R -->
                                    <div class="space-y-2">
                                        <label class="font-medium text-slate-300 text-sm">Reward Ratio</label>
                                        <div class="relative group/input">
                                            <span
                                                class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs">1:</span>
                                            <input type="number" id="inputRRR" value="3.0" step="0.5"
                                                class="w-full bg-slate-950/50 border border-slate-700 rounded-xl h-12 pl-7 pr-4 text-white font-mono focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all shadow-inner">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Calculated Risk Footer -->
                            <div class="mt-8 pt-6 border-t border-slate-700/50 flex justify-between items-center group">
                                <div>
                                    <p class="text-xs text-slate-500 uppercase font-bold tracking-wider">Total Risk
                                        Amount</p>
                                    <p class="text-[10px] text-slate-600">If stop loss is hit</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-black text-rose-500 drop-shadow-sm font-mono"
                                        id="displayRiskAmount">-$100.00</p>
                                </div>
                            </div>
                        </div>

                        <!-- Ticks/Points Tool (Mini) -->
                        <div class="bg-slate-900/30 border border-slate-800 rounded-xl p-4 flex items-center gap-4">
                            <span class="material-symbols-outlined text-slate-600">straighten</span>
                            <div class="flex-1">
                                <label class="text-xs text-slate-400 block mb-1">Stop Size (Ticks/Points)</label>
                                <input type="number" id="inputTicks" value="25"
                                    class="w-24 bg-transparent border-b border-slate-700 text-white font-mono py-1 focus:outline-none focus:border-indigo-500">
                            </div>
                            <div class="text-right">
                                <label class="text-xs text-slate-400 block mb-1">Target</label>
                                <p class="text-emerald-400 font-mono font-bold" id="displayTargetTicks">75 Ticks</p>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN: RESULTS -->
                    <div class="lg:col-span-8 flex flex-col gap-6">

                        <!-- Hero Result Card -->
                        <div
                            class="relative bg-gradient-to-r from-indigo-900/40 to-slate-900/40 border border-indigo-500/20 rounded-2xl p-8 overflow-hidden shadow-2xl">
                            <div class="absolute top-0 right-0 p-12 opacity-5 pointer-events-none">
                                <span class="material-symbols-outlined text-9xl text-white">token</span>
                            </div>

                            <div
                                class="relative z-10 flex flex-col md:flex-row gap-8 items-start md:items-center justify-between">
                                <div>
                                    <h4 class="text-indigo-400 font-bold uppercase tracking-widest text-xs mb-2">Primary
                                        Position Size</h4>
                                    <div class="flex items-baseline gap-1">
                                        <h1 class="text-5xl md:text-6xl font-black text-white tracking-tighter"
                                            id="displayPositionSize">$5,000</h1>
                                        <span class="text-xl text-slate-500 font-bold">USD</span>
                                    </div>
                                    <p class="text-slate-400 mt-2 text-sm max-w-md">
                                        Open a position of this size to risk exactly <span class="text-white font-bold"
                                            id="displayRiskPercentHero">1.0%</span> of your capital with a <span
                                            class="text-white font-bold" id="displaySLPercentHero">2.0%</span> stop
                                        loss.
                                    </p>
                                </div>

                                <div class="flex flex-col gap-2 min-w-[200px]">
                                    <div
                                        class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-4 backdrop-blur-sm">
                                        <p class="text-[10px] text-emerald-400 uppercase font-bold tracking-wider mb-1">
                                            Potential Profit</p>
                                        <p class="text-2xl font-black text-emerald-400 font-mono"
                                            id="displayProfitAmount">+$300.00</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Leverage Matrix -->
                        <div
                            class="bg-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl overflow-hidden shadow-xl flex-1 flex flex-col">
                            <div
                                class="p-6 border-b border-slate-700/50 flex justify-between items-center bg-slate-950/30">
                                <h3 class="text-white font-bold flex items-center gap-2">
                                    <span class="material-symbols-outlined text-amber-500">warning</span>
                                    Leverage & Safety Analysis
                                </h3>
                                <div class="flex gap-2 text-xs">
                                    <span
                                        class="px-2 py-1 rounded bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">Safe</span>
                                    <span
                                        class="px-2 py-1 rounded bg-amber-500/10 text-amber-400 border border-amber-500/20">Caution</span>
                                    <span
                                        class="px-2 py-1 rounded bg-rose-500/10 text-rose-400 border border-rose-500/20">Danger</span>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr
                                            class="bg-slate-950/50 text-xs uppercase tracking-wider text-slate-500 border-b border-slate-700/50">
                                            <th class="px-6 py-4 font-semibold">Leverage</th>
                                            <th class="px-6 py-4 font-semibold">Liq. Distance</th>
                                            <th class="px-6 py-4 font-semibold text-right">Margin</th>
                                            <th class="px-6 py-4 font-semibold text-right">Position Size</th>
                                            <th class="px-6 py-4 font-semibold text-center">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="leverageTableBody"
                                        class="divide-y divide-slate-800/50 text-sm font-mono text-slate-300">
                                        <!-- Dynamic Rows -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

        <!-- VIEW: COMP SOLVER SIMULATOR -->
        <div id="view-simulator" class="view-section hidden w-full h-full pb-20 fade-in">
            <!-- Header -->
            <div class="mb-6 flex justify-between items-end">
                <div>
                    <h2 class="text-3xl font-black tracking-tight flex items-center gap-3">
                        <span class="p-2 bg-indigo-500/10 text-indigo-500 rounded-lg border border-indigo-500/20">
                            <span class="material-symbols-outlined">rocket_launch</span>
                        </span>
                        Compounding Simulator
                    </h2>
                    <p class="text-text-muted-light dark:text-text-muted-dark mt-1">Project your growth and analyze ruin
                        risk.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- LEFT COLUMN: Inputs & Analysis -->
                <div class="lg:col-span-4 flex flex-col gap-6">
                    <!-- Controls Card -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border-2 border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm text-primary">tune</span>
                            Simulation Parameters
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Starting
                                    Capital ($)</label>
                                <input type="number" id="sim-input-capital" value="10000"
                                    class="w-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg px-4 py-2 font-mono text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label
                                        class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Win
                                        Rate (%)</label>
                                    <input type="number" id="sim-input-winrate" value="50" min="1" max="99"
                                        class="w-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg px-4 py-2 font-mono text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                </div>
                                <div>
                                    <label
                                        class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Risk
                                        (%)</label>
                                    <input type="number" id="sim-input-risk" value="2.0" step="0.1"
                                        class="w-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg px-4 py-2 font-mono text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                </div>
                            </div>

                            <div>
                                <label
                                    class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Reward
                                    Ratio (1:X)</label>
                                <input type="number" id="sim-input-rrr" value="2.0" step="0.1"
                                    class="w-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg px-4 py-2 font-mono text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </div>

                            <button onclick="app.simulator.runSimulation()"
                                class="w-full py-3 bg-primary hover:bg-primary-dark text-white rounded-xl font-bold uppercase tracking-wide shadow-lg shadow-primary/20 transition-all active:scale-[0.98] mt-2">
                                Run Simulation
                            </button>
                        </div>
                    </div>

                    <!-- Wipeout Analysis Card -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border-2 border-border-light dark:border-border-dark shadow-sm">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2 text-rose-500">
                            <span class="material-symbols-outlined text-sm">dangerous</span>
                            Risk Analysis
                        </h3>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-text-muted-light dark:text-text-muted-dark">Consecutive Losses to
                                Ruin:</span>
                            <span id="sim-wipeout-count" class="font-black font-mono text-xl">0</span>
                        </div>
                        <p class="text-xs text-text-muted-light dark:text-text-muted-dark leading-relaxed"
                            id="sim-wipeout-msg">
                            Calculating...
                        </p>
                    </div>

                    <!-- Summary Stats -->
                    <div class="grid grid-cols-2 gap-4">
                        <div
                            class="bg-surface-light dark:bg-surface-dark p-4 rounded-xl border-2 border-border-light dark:border-border-dark shadow-sm">
                            <p class="text-xs text-text-muted-light dark:text-text-muted-dark uppercase font-bold">Total
                                ROI</p>
                            <p id="sim-result-roi" class="text-xl font-black text-emerald-500">0%</p>
                        </div>
                        <div
                            class="bg-surface-light dark:bg-surface-dark p-4 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
                            <p class="text-xs text-text-muted-light dark:text-text-muted-dark uppercase font-bold">Max
                                Drawdown</p>
                            <p id="sim-result-dd" class="text-xl font-black text-rose-500">0%</p>
                        </div>
                    </div>
                </div>

                <!-- RIGHT COLUMN: Chart & Table -->
                <div class="lg:col-span-8 flex flex-col gap-6">
                    <!-- Chart -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark p-6 rounded-2xl border border-border-light dark:border-border-dark shadow-sm h-[300px] relative">
                        <div class="absolute top-6 right-6 z-10">
                            <div class="bg-slate-900/80 backdrop-blur px-4 py-2 rounded-lg border border-indigo-500/30">
                                <p class="text-[10px] text-indigo-300 uppercase font-bold">Final Capital</p>
                                <p id="sim-result-capital" class="text-2xl font-black text-white">$0</p>
                            </div>
                        </div>
                        <canvas id="chart-simulator"></canvas>
                    </div>

                    <!-- Trade History Table -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark rounded-2xl border border-border-light dark:border-border-dark shadow-sm overflow-hidden flex-1 flex flex-col min-h-[400px]">
                        <div
                            class="p-4 border-b border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800/50">
                            <h3 class="font-bold text-sm uppercase tracking-wide">Detailed Trade History</h3>
                        </div>
                        <div class="overflow-y-auto flex-1 custom-scrollbar max-h-[400px]">
                            <table class="w-full text-left text-sm">
                                <thead
                                    class="bg-slate-50 dark:bg-slate-800/80 text-xs uppercase font-bold text-text-muted-light dark:text-text-muted-dark sticky top-0 backdrop-blur-md z-10">
                                    <tr>
                                        <th class="px-6 py-3">#</th>
                                        <th class="px-6 py-3">Start Cap</th>
                                        <th class="px-6 py-3">Risk Amt</th>
                                        <th class="px-6 py-3 text-center">Outcome</th>
                                        <th class="px-6 py-3 text-right">PnL</th>
                                        <th class="px-6 py-3 text-right">End Cap</th>
                                    </tr>
                                </thead>
                                <tbody id="sim-table-body"
                                    class="divide-y divide-border-light dark:divide-border-dark font-mono">
                                    <!-- Dynamic rows -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- VIEW: HABIT TRACKER -->
        <div id="view-habits" class="view-section hidden w-full max-w-[1440px] mx-auto pb-20 fade-in">
            <!-- Header: Identity & Stats -->
            <div class="mb-10 text-center">
                <p class="text-indigo-400 font-bold tracking-widest uppercase text-xs mb-3">Protocol & Consistency</p>
                <h2
                    class="text-3xl md:text-5xl font-black text-text-main-light dark:text-text-main-dark tracking-tight leading-tight mb-6">
                    Build Your <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-cyan-400">Edge</span>
                </h2>

                <!-- Global Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark p-4 rounded-xl text-center shadow-lg shadow-indigo-500/5">
                        <p
                            class="text-[10px] text-text-muted-light dark:text-text-muted-dark font-bold uppercase tracking-wider mb-1">
                            Active Habits</p>
                        <p class="text-2xl font-black text-text-main-light dark:text-text-main-dark"
                            id="stat-active-count">0
                        </p>
                    </div>
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark p-4 rounded-xl text-center shadow-lg shadow-emerald-500/5">
                        <p
                            class="text-[10px] text-text-muted-light dark:text-text-muted-dark font-bold uppercase tracking-wider mb-1">
                            Perfect Days</p>
                        <p class="text-2xl font-black text-emerald-400" id="stat-perfect-days">0</p>
                    </div>
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark p-4 rounded-xl text-center shadow-lg shadow-amber-500/5">
                        <p
                            class="text-[10px] text-text-muted-light dark:text-text-muted-dark font-bold uppercase tracking-wider mb-1">
                            Current Streak</p>
                        <p class="text-2xl font-black text-amber-500 flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-xl">local_fire_department</span>
                            <span id="stat-global-streak">0</span>
                        </p>
                    </div>
                    <button onclick="app.addHabitModal()"
                        class="bg-primary hover:bg-primary-dark text-white p-4 rounded-xl font-bold transition-all hover:scale-105 active:scale-95 shadow-lg shadow-primary/20 flex flex-col items-center justify-center gap-1 group">
                        <span
                            class="material-symbols-outlined text-2xl group-hover:-translate-y-1 transition-transform">add_circle</span>
                        <span class="text-xs">New Protocol</span>
                    </button>
                </div>
            </div>

            <!-- MAIN GRID -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">

                <!-- LEFT COL: Good Habits Grid -->
                <div class="lg:col-span-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3
                            class="font-bold text-lg flex items-center gap-2 text-text-main-light dark:text-text-main-dark">
                            <span class="material-symbols-outlined text-emerald-500">check_circle</span>
                            Daily Protocols
                        </h3>
                        <span class="text-xs text-text-muted-light dark:text-text-muted-dark italic"
                            id="date-display">Today</span>
                    </div>

                    <!-- Dynamic Habit Grid -->
                    <div id="habit-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Habits injected here -->
                        <div
                            class="col-span-full p-12 text-center border-2 border-dashed border-border-light dark:border-border-dark rounded-xl">
                            <span
                                class="material-symbols-outlined text-4xl text-slate-600 mb-2">playlist_add_check</span>
                            <p class="text-slate-500 font-medium">No habits defined yet.</p>
                            <button onclick="app.addHabitModal()"
                                class="mt-4 text-emerald-500 font-bold text-sm hover:underline">Create your first
                                protocol</button>
                        </div>
                    </div>
                </div>

                <!-- RIGHT COL: Bad Habits & Detail View -->
                <div class="lg:col-span-4 space-y-8">

                    <!-- Bad Habits Section -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark border border-rose-500/20 rounded-2xl p-6 shadow-xl shadow-rose-900/5 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-5">
                            <span class="material-symbols-outlined text-8xl text-rose-500">block</span>
                        </div>

                        <div class="flex justify-between items-center mb-6 relative z-10">
                            <h3 class="font-bold text-lg text-rose-500 flex items-center gap-2">
                                <span class="material-symbols-outlined">warning</span>
                                The Anti-Protocol
                            </h3>
                            <button onclick="app.addBadHabitModal()"
                                class="text-xs bg-rose-500/10 hover:bg-rose-500/20 text-rose-500 px-3 py-1.5 rounded-lg transition-colors font-bold">
                                + Track Leak
                            </button>
                        </div>

                        <div id="bad-habit-list" class="space-y-3 relative z-10">
                            <!-- Bad Habits injected here -->
                        </div>
                    </div>

                    <!-- Mini Tip Card (Rotates) -->
                    <div
                        class="bg-gradient-to-br from-indigo-900 to-slate-900 rounded-2xl p-6 border border-white/5 relative overflow-hidden">
                        <div class="absolute -bottom-10 -right-10 bg-indigo-500/20 w-32 h-32 rounded-full blur-3xl">
                        </div>
                        <h4 class="text-indigo-300 font-bold text-xs uppercase tracking-wider mb-2">Atomic Strategy</h4>
                        <p class="text-slate-300 text-sm italic leading-relaxed">
                            "You do not rise to the level of your goals. You fall to the level of your systems."
                        </p>
                    </div>

                </div>
            </div>
        </div>
        </div>
        </div>
        </div>

        <!-- MODAL: Add New Habit -->
        <div id="modal-add-habit" class="fixed inset-0 z-[120] hidden">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity"
                onclick="document.getElementById('modal-add-habit').classList.add('hidden')"></div>

            <!-- Modal Content -->
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-surface-light dark:bg-surface-dark rounded-2xl shadow-2xl border border-border-light dark:border-border-dark p-6 scale-100 transition-transform">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">add_task</span>
                    Design New Habit
                </h3>

                <form id="form-add-habit" onsubmit="event.preventDefault(); app.saveNewHabit();">
                    <input type="hidden" name="habit_id">
                    <div class="space-y-4">
                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Habit
                                Name (The Behavior)</label>
                            <input type="text" name="habit_name" placeholder="e.g., Wait for candle close" required
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary outline-none">
                        </div>

                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Target
                                consistency (Days)</label>
                            <input type="number" name="habit_target" placeholder="e.g. 66" value="66" min="1"
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-primary outline-none">
                        </div>

                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Cue
                                (Make it Obvious)</label>
                            <input type="text" name="habit_cue" placeholder="When price hits level..."
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Craving
                                (Make it Attractive)</label>
                            <input type="text" name="habit_craving" placeholder="I will visualize the win..."
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-pink-500 outline-none">
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Reward
                                (Make it Satisfying)</label>
                            <input type="text" name="habit_reward" placeholder="Check off list..."
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-amber-500 outline-none">
                        </div>

                        <div class="pt-4 flex justify-end gap-3">
                            <button type="button"
                                onclick="document.getElementById('modal-add-habit').classList.add('hidden')"
                                class="px-4 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Cancel</button>
                            <button type="submit"
                                class="px-6 py-2 rounded-lg text-sm font-bold bg-primary text-white hover:bg-primary-dark shadow-lg shadow-primary/20 transition-all">Save
                                Protocol</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- MODAL: Edit User Access -->
        <div id="modal-edit-access" class="fixed inset-0 z-[120] hidden">
            <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity"
                onclick="document.getElementById('modal-edit-access').classList.add('hidden')"></div>
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm bg-surface-light dark:bg-surface-dark rounded-2xl shadow-2xl border border-border-light dark:border-border-dark p-6">
                <h3 class="text-xl font-bold mb-1 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">verified_user</span>
                    Edit Access
                </h3>
                <p class="text-xs text-text-muted-light dark:text-text-muted-dark mb-4">Select features for <span
                        id="access-username" class="font-bold text-text-main-light dark:text-text-main-dark">User</span>
                </p>

                <form id="form-edit-access" onsubmit="event.preventDefault(); app.saveUserAccess();">
                    <input type="hidden" id="access-username-hidden">
                    <div class="space-y-2 mb-6">
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="dashboard"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Dashboard</span>
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="calendar"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Calendar</span>
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="journal"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Tortol Journal</span>
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="entry"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Log Trade</span>
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="habits"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Habit Tracker</span>
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="calculator"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Calculator</span>
                        </label>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors cursor-pointer">
                            <input type="checkbox" name="access_feature" value="simulator"
                                class="w-4 h-4 rounded text-primary focus:ring-primary accent-primary">
                            <span class="text-sm font-medium">Simulator</span>
                        </label>
                        <!-- Admin special flag -->
                        <div class="border-t border-border-light dark:border-border-dark my-2"></div>
                        <label
                            class="flex items-center gap-3 p-3 rounded-xl bg-amber-50 dark:bg-amber-900/10 hover:bg-amber-100 dark:hover:bg-amber-900/20 transition-colors cursor-pointer border border-amber-200 dark:border-amber-800/30">
                            <input type="checkbox" name="access_feature" value="admin"
                                class="w-4 h-4 rounded text-amber-500 focus:ring-amber-500 accent-amber-500">
                            <span class="text-sm font-bold text-amber-700 dark:text-amber-400">Admin Access</span>
                        </label>
                    </div>

                    <div class="flex justify-end gap-3">
                        <button type="button"
                            onclick="document.getElementById('modal-edit-access').classList.add('hidden')"
                            class="px-4 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Cancel</button>
                        <button type="submit"
                            class="px-6 py-2 rounded-lg text-sm font-bold bg-primary text-white hover:bg-primary-dark shadow-lg shadow-primary/20 transition-all">Save
                            Permissions</button>
                    </div>
                </form>
            </div>
        </div>



        <!-- MODAL: Add Bad Habit -->
        <div id="modal-add-bad-habit" class="fixed inset-0 z-50 hidden">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity"
                onclick="document.getElementById('modal-add-bad-habit').classList.add('hidden')"></div>

            <!-- Modal Content -->
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-surface-light dark:bg-surface-dark rounded-2xl shadow-2xl border-2 border-rose-500/20 p-6 scale-100 transition-transform">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2 text-rose-500">
                    <span class="material-symbols-outlined">warning</span>
                    Report Bad Habit
                </h3>

                <form id="form-add-bad-habit" onsubmit="event.preventDefault(); app.saveBadHabit();">
                    <div class="space-y-4">
                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Bad
                                Habit Name</label>
                            <input type="text" name="bad_habit_name" placeholder="e.g., Revenge Trading" required
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-rose-500 outline-none">
                        </div>

                        <div>
                            <label
                                class="block text-xs font-bold uppercase text-text-muted-light dark:text-text-muted-dark mb-1">Consequence
                                (Make it Painful)</label>
                            <input type="text" name="bad_habit_consequence" placeholder="e.g., Stop trading for the day"
                                required
                                class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none">
                        </div>

                        <div class="pt-4 flex justify-end gap-3">
                            <button type="button"
                                onclick="document.getElementById('modal-add-bad-habit').classList.add('hidden')"
                                class="px-4 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Cancel</button>
                            <button type="submit"
                                class="px-6 py-2 rounded-lg text-sm font-bold bg-rose-500 text-white hover:bg-rose-600 shadow-lg shadow-rose-500/20 transition-all">Track
                                Leak</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="view-calendar" class="view-section hidden space-y-6 w-full max-w-full h-full pb-20">
            <div class="flex flex-col md:flex-row justify-between items-end gap-4">
                <div class="flex flex-col gap-2">
                    <h2 class="text-3xl font-black tracking-tight">Calendar</h2>
                    <p class="text-text-muted-light dark:text-text-muted-dark">Visualize your consistency.</p>
                </div>
                <!-- Month Navigation -->
                <div
                    class="flex items-center bg-surface-light dark:bg-surface-dark p-1 rounded-lg border border-border-light dark:border-border-dark">
                    <button onclick="app.changeMonth(-1)"
                        class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors">
                        <span class="material-symbols-outlined text-sm">chevron_left</span>
                    </button>
                    <span id="calendar-month-year" class="px-4 font-bold text-sm min-w-[140px] text-center">January
                        2024</span>
                    <button onclick="app.changeMonth(1)"
                        class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors">
                        <span class="material-symbols-outlined text-sm">chevron_right</span>
                    </button>
                </div>
            </div>

            <div
                class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm p-6 overflow-hidden">
                <!-- Days Header -->
                <div class="grid grid-cols-7 mb-4">
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Sun</div>
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Mon</div>
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Tue</div>
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Wed</div>
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Thu</div>
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Fri</div>
                    <div
                        class="text-center text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase">
                        Sat</div>
                </div>
                <!-- Calendar Grid -->
                <div id="calendar-grid" class="grid grid-cols-7 gap-2 auto-rows-fr">
                    <!-- Dynamic Days -->
                </div>
            </div>
        </div>

        <!-- VIEW: TRADE ENTRY (Cockpit) -->
        <div id="view-entry" class="view-section hidden h-full pb-0 flex flex-col">
            <div class="flex justify-between items-center mb-4 shrink-0 px-1">
                <div class="flex items-center gap-4">
                    <button onclick="app.navigate('journal')"
                        class="p-2 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-colors">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <div>
                        <h2 class="text-xl font-black tracking-tight" id="entry-title">Log New Trade</h2>
                        <p class="text-xs text-text-muted-light dark:text-text-muted-dark">Capture the details that
                            matter.</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="app.navigate('journal')"
                        class="px-4 py-2 rounded-lg text-sm font-bold text-text-muted-light dark:text-text-muted-dark hover:bg-slate-100 dark:hover:bg-slate-800 transition-all">
                        Cancel
                    </button>
                    <button onclick="document.getElementById('trade-form').submkt()" class="hidden"></button>
                    <!-- Dummy for Enter key -->
                    <button onclick="app.saveDraft()"
                        class="px-4 py-2 rounded-lg text-sm font-bold bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition-all flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">drafts</span>
                        Save Progress
                    </button>
                    <button onclick="app.saveTrade()"
                        class="px-6 py-2 rounded-lg text-sm font-bold bg-primary hover:bg-primary-dark text-white shadow-lg shadow-primary/20 transition-all flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">save</span>
                        Save Trade
                    </button>
                </div>
            </div>

            <form id="trade-form" class="h-full flex flex-col overflow-hidden"
                onsubmit="event.preventDefault(); app.saveTrade();">
                <input type="hidden" name="id">

                <!-- Main Form Area (Cockpit View) -->
                <div
                    class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark p-4 shadow-sm flex-1 overflow-y-auto custom-scrollbar">
                    <div class="grid grid-cols-12 gap-x-3 gap-y-3">

                        <!-- ROW 1: Context (Date, Time, Symbol, Type, Timeframe, Direction) -->
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Date</span>
                                <input required type="date" name="date"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Time</span>
                                <input required type="time" name="time"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Symbol</span>
                                <input required type="text" name="symbol" placeholder="BTC/USD"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs font-bold uppercase focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Type</span>
                                <select name="type"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="Crypto">Crypto</option>
                                    <option value="Forex">Forex</option>
                                    <option value="Stocks">Stocks</option>
                                    <option value="Commodities">Cmdty</option>
                                    <option value="Indices">Indices</option>
                                </select>
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Timeframe</span>
                                <input list="timeframe-options" name="timeframe" placeholder="e.g. 15m"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                <datalist id="timeframe-options">
                                    <option value="1m">1 Minute</option>
                                    <option value="5m">5 Minute</option>
                                    <option value="15m">15 Minute</option>
                                    <option value="1h">1 Hour</option>
                                    <option value="4h">4 Hour</option>
                                    <option value="1D">Daily</option>
                                    <option value="1W">Weekly</option>
                                </datalist>
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <span
                                class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Direction</span>
                            <div class="grid grid-cols-2 gap-1">
                                <label class="cursor-pointer">
                                    <input type="radio" name="side" value="Long" class="peer sr-only" checked>
                                    <div
                                        class="h-[26px] rounded border border-border-light dark:border-border-dark flex items-center justify-center font-bold text-[10px] text-text-muted-light dark:text-text-muted-dark peer-checked:bg-win peer-checked:text-white peer-checked:border-win transition-all">
                                        Long
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="side" value="Short" class="peer sr-only">
                                    <div
                                        class="h-[26px] rounded border border-border-light dark:border-border-dark flex items-center justify-center font-bold text-[10px] text-text-muted-light dark:text-text-muted-dark peer-checked:bg-loss peer-checked:text-white peer-checked:border-loss transition-all">
                                        Short
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- ROW 2: Setup Details -->
                        <div class="col-span-6 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Trade
                                    Setup</span>
                                <select name="trade_setup"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="">-- Select --</option>
                                    <option value="Scalping">Scalping</option>
                                    <option value="Intraday">Intraday</option>
                                    <option value="Swing">Swing</option>
                                </select>
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">HTF
                                    Structure</span>
                                <select name="htf_structure"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="">-- Select --</option>
                                    <option value="Uptrend">Uptrend</option>
                                    <option value="Downtrend">Downtrend</option>
                                    <option value="Consolidation">Consolidation</option>
                                </select>
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Execution
                                    Setup</span>
                                <select name="execution_setup"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="">-- Select --</option>
                                    <option value="TRBO">TRBO</option>
                                    <option value="TLSBD">TLSBD</option>
                                    <option value="Bounce">Bounce</option>
                                    <option value="Correction">Correction</option>
                                    <option value="TABO">TABO</option>
                                    <option value="Transition Play">Transition Play (Rev/Pat)</option>
                                    <option value="HALMACCI">HALMACCI</option>
                                </select>
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Duration</span>
                                <select name="duration"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="">-- Select --</option>
                                    <option value="Immediate">Immediate (<30 Days)</option>
                                    <option value="Key Level">Key Level (>30 Days)</option>
                                </select>
                            </label>
                        </div>

                        <div class="col-span-12 border-t border-border-light dark:border-border-dark my-0.5"></div>

                        <!-- ROW 3: Execution -->
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Entry</span>
                                <input type="number" step="any" name="entry_price" placeholder="0.00"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs font-mono focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Exit</span>
                                <input type="number" step="any" name="exit_price" placeholder="0.00"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs font-mono focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-2">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Size</span>
                                <input type="text" name="position_size" placeholder="Size"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-6 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">PnL
                                    %</span>
                                <input type="number" step="0.01" name="pnl_percentage" placeholder="%"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs font-mono focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>
                        <div class="col-span-12 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Net
                                    PnL ($)</span>
                                <input required type="number" step="0.01" name="pnl" placeholder="0.00"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 font-mono text-sm font-bold focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>

                        <div class="col-span-12 border-t border-border-light dark:border-border-dark my-0.5"></div>

                        <!-- ROW 4: Analysis -->
                        <div class="col-span-12 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Primary
                                    Error</span>
                                <select name="primary_error"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="">-- Select --</option>
                                    <option value="None">None (Good Trade)</option>
                                    <option value="Early Entry">Early Entry</option>
                                    <option value="FOMO">FOMO</option>
                                    <option value="Revenge Trade">Revenge Trade</option>
                                    <option value="Ignoring Stop Loss">No Stop Loss</option>
                                    <option value="Macro Event / News">Macro Event / News</option>
                                    <option value="Poor Risk Management">Bad Risk Mgmt</option>
                                    <option value="Executional Error">Executional Error</option>
                                    <option value="Other">Other</option>
                                </select>
                            </label>
                        </div>
                        <div class="col-span-12 md:col-span-3">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Emotion</span>
                                <select name="emotional_state"
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                                    <option value="">-- Select --</option>
                                    <option value="Calm">Calm</option>
                                    <option value="Anxious">Anxious</option>
                                    <option value="Greedy">Greedy</option>
                                    <option value="Frustrated">Frustrated</option>
                                    <option value="Euphoric">Euphoric</option>
                                </select>
                            </label>
                        </div>
                        <div class="col-span-12 md:col-span-6">
                            <label class="block">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">One
                                    Main Takeaway</span>
                                <input type="text" name="takeaway" placeholder="One lesson..."
                                    class="w-full rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            </label>
                        </div>

                        <div class="col-span-12 md:col-span-7">
                            <label class="block h-full flex flex-col">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Detailed
                                    Notes</span>
                                <textarea name="notes"
                                    class="w-full flex-1 rounded bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-2 py-1.5 text-xs focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all resize-none"
                                    placeholder="Context, Setup, Mistake details..."></textarea>
                            </label>
                        </div>
                        <div class="col-span-12 md:col-span-5 flex flex-col gap-2">
                            <!-- Plan Image -->
                            <div class="flex-1 flex flex-col">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Plan
                                    (Before)</span>
                                <div
                                    class="relative flex-1 border-2 border-dashed border-border-light dark:border-border-dark rounded-lg flex items-center justify-center bg-background-light dark:bg-background-dark hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer group min-h-[80px]">
                                    <input type="file" id="trade-image-input-plan" accept="image/*"
                                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer text-sm z-10">
                                    <div class="text-center p-2 group-hover:scale-105 transition-transform z-0">
                                        <span
                                            class="material-symbols-outlined text-text-muted-light text-2xl mb-1">architecture</span>
                                        <p class="text-[10px] text-text-muted-light font-bold">Upload Plan</p>
                                    </div>
                                    <div id="image-preview-container-plan"
                                        class="hidden absolute inset-0 bg-background-light dark:bg-background-dark rounded-lg flex items-center justify-center overflow-hidden z-20">
                                        <img id="image-preview-plan" src="" alt="Plan Preview"
                                            class="w-full h-full object-contain">
                                        <button type="button" onclick="app.clearImage('plan'); event.stopPropagation();"
                                            class="absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-1 transition-colors pointer-events-auto">
                                            <span class="material-symbols-outlined text-sm">close</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Result Image -->
                            <div class="flex-1 flex flex-col">
                                <span
                                    class="text-[10px] font-bold uppercase text-text-muted-light dark:text-text-muted-dark tracking-wider mb-0.5 block">Result
                                    (After)</span>
                                <div
                                    class="relative flex-1 border-2 border-dashed border-border-light dark:border-border-dark rounded-lg flex items-center justify-center bg-background-light dark:bg-background-dark hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer group min-h-[80px]">
                                    <input type="file" id="trade-image-input-result" accept="image/*"
                                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer text-sm z-10">
                                    <div class="text-center p-2 group-hover:scale-105 transition-transform z-0">
                                        <span
                                            class="material-symbols-outlined text-text-muted-light text-2xl mb-1">add_photo_alternate</span>
                                        <p class="text-[10px] text-text-muted-light font-bold">Upload Result</p>
                                    </div>
                                    <div id="image-preview-container-result"
                                        class="hidden absolute inset-0 bg-background-light dark:bg-background-dark rounded-lg flex items-center justify-center overflow-hidden z-20">
                                        <img id="image-preview-result" src="" alt="Result Preview"
                                            class="w-full h-full object-contain">
                                        <button type="button"
                                            onclick="app.clearImage('result'); event.stopPropagation();"
                                            class="absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-1 transition-colors pointer-events-auto">
                                            <span class="material-symbols-outlined text-sm">close</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        </div>

        <footer
            class="text-center text-xs text-text-muted-light dark:text-text-muted-dark py-3 border-t border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark px-4">
            &copy; 2026. A bit crazy journal. Created by JuniLegend. v1.1
        </footer>
    </main>

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay"
        class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/80 backdrop-blur-lg overflow-y-auto py-8">
        <div
            class="glass p-8 rounded-3xl w-full max-w-md mx-4 shadow-2xl scale-100 transition-transform duration-500 my-auto">
            <div class="text-center mb-8">
                <div
                    class="w-20 h-20 bg-primary/20 rounded-3xl mx-auto mb-4 overflow-hidden border-2 border-primary/50 flex items-center justify-center">
                    <img src="logo.png?v=2" class="w-full h-full object-cover" alt="Turtle Logo">
                </div>
                <h2 class="text-3xl font-black tracking-tighter text-white" id="login-title">Tortol Trader Journal</h2>
                <p class="text-indigo-200 text-xs mt-2 uppercase font-bold tracking-widest">Invite Only Access</p>
            </div>

            <!-- LOGIN FORM -->
            <form id="login-form" onsubmit="event.preventDefault(); app.handleLogin();" class="space-y-4">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold uppercase text-indigo-300 tracking-widest pl-1">Username</label>
                    <input required type="text" name="username" placeholder="Enter your username"
                        class="w-full rounded-xl bg-white/10 border border-white/10 px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-white/20">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold uppercase text-indigo-300 tracking-widest pl-1">Password</label>
                    <input required type="password" name="password" placeholder=""
                        class="w-full rounded-xl bg-white/10 border border-white/10 px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-white/20">
                </div>
                <button type="submit"
                    class="w-full bg-primary hover:bg-primary-dark text-white font-black py-4 rounded-xl shadow-xl shadow-primary/30 transition-all mt-6 active:scale-95">
                    LOG IN
                </button>
                <div class="text-center mt-4">
                    <button type="button" onclick="app.toggleAuthMode('signup')"
                        class="text-xs font-bold text-indigo-300 hover:text-white transition-colors underline">
                        Request Access / Sign Up
                    </button>
                    <span class="text-white/20 mx-2">|</span>
                    <button type="button" onclick="app.toggleAuthMode('reset')"
                        class="text-xs font-bold text-indigo-300 hover:text-white transition-colors underline">
                        Forgot Password?
                    </button>
                </div>
            </form>

            <!-- SIGNUP FORM (Hidden by default) -->
            <form id="signup-form" onsubmit="event.preventDefault(); app.handleSignup();" class="space-y-4 hidden">
                <div class="p-3 bg-amber-500/20 border border-amber-500/50 rounded-xl mb-4">
                    <p class="text-amber-200 text-xs font-medium text-center">
                        Access is granted manually by the administrator. Submit your request below.
                    </p>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold uppercase text-indigo-300 tracking-widest pl-1">Proposed
                        Username</label>
                    <input required type="text" name="signup_username" placeholder="Desired username"
                        class="w-full rounded-xl bg-white/10 border border-white/10 px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-white/20">
                </div>
                <button type="submit"
                    class="w-full bg-win hover:bg-win-dark text-white font-black py-4 rounded-xl shadow-xl shadow-win/30 transition-all mt-6 active:scale-95">
                    REQUEST ACCESS
                </button>
                <div class="text-center mt-4">
                    <button type="button" onclick="app.toggleAuthMode('login')"
                        class="text-xs font-bold text-indigo-300 hover:text-white transition-colors underline">
                        Back to Login
                    </button>
                </div>
            </form>

            <!-- RESET PASSWORD FORM -->
            <form id="reset-form" onsubmit="event.preventDefault(); app.handleResetRequest();" class="space-y-4 hidden">
                <div class="p-3 bg-indigo-500/20 border border-indigo-500/50 rounded-xl mb-4">
                    <p class="text-indigo-200 text-xs font-medium text-center">
                        Submit your username to request a password reset from the administrator.
                    </p>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold uppercase text-indigo-300 tracking-widest pl-1">Username</label>
                    <input required type="text" name="reset_username" placeholder="Your username"
                        class="w-full rounded-xl bg-white/10 border border-white/10 px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-white/20">
                </div>
                <button type="submit"
                    class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-black py-4 rounded-xl shadow-xl shadow-indigo-500/30 transition-all mt-6 active:scale-95">
                    REQUEST RESET
                </button>
                <div class="text-center mt-4">
                    <button type="button" onclick="app.toggleAuthMode('login')"
                        class="text-xs font-bold text-indigo-300 hover:text-white transition-colors underline">
                        Back to Login
                    </button>
                </div>
            </form>

            <div class="mt-8 pt-6 border-t border-white/10 text-center space-y-4">
                <div class="text-left bg-white/5 p-4 rounded-xl border border-white/5">
                    <h4 class="text-[10px] font-bold text-indigo-200 uppercase tracking-widest mb-2">Privacy Policy</h4>
                    <p class="text-[10px] text-zinc-400 leading-relaxed">
                        Your trading data is secure but accessible by the administrator for system analytics,
                        troubleshooting, and platform improvements. We respect your privacy and will never share your
                        personal trading strategies or financial data with third parties.
                    </p>
                    <p class="text-[10px] text-zinc-400 leading-relaxed mt-2">
                        By using this application, you acknowledge that the administrator has access to your logged data
                        for
                        these specific maintenance purposes.
                    </p>
                </div>
                <p class="text-white/40 text-[10px] font-bold tracking-widest uppercase">Version 1.0  JuniLegend</p>
            </div>
        </div>
    </div>

    <!-- ADMIN CONSOLE OVERLAY -->
    <div id="admin-overlay"
        class="hidden fixed inset-0 z-[110] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4">
        <div
            class="bg-surface-light dark:bg-surface-dark w-full max-w-2xl rounded-2xl shadow-2xl border border-border-light dark:border-border-dark flex flex-col max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div
                class="px-6 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-amber-500/10 rounded-lg text-amber-600 dark:text-amber-400">
                        <span class="material-symbols-outlined">admin_panel_settings</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-black text-text-main-light dark:text-text-main-dark">Admin Console</h3>
                        <p class="text-xs text-text-muted-light dark:text-text-muted-dark">System management</p>
                    </div>
                </div>
                <button onclick="document.getElementById('admin-overlay').classList.add('hidden')"
                    class="p-2 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors text-text-muted-light dark:text-text-muted-dark">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-8">

                <!-- Section 1: Profile Management -->
                <section>
                    <h4
                        class="text-sm font-bold uppercase tracking-wider text-text-muted-light dark:text-text-muted-dark mb-4 border-b border-border-light dark:border-border-dark pb-2">
                        My Admin Profile
                    </h4>
                    <form onsubmit="event.preventDefault(); app.updateAdminProfile();"
                        class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                        <label class="block">
                            <span
                                class="text-xs font-bold text-text-main-light dark:text-text-main-dark mb-1 block">Username</span>
                            <input type="text" id="admin-username-input"
                                class="w-full rounded-lg bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 outline-none">
                        </label>
                        <label class="block">
                            <span class="text-xs font-bold text-text-main-light dark:text-text-main-dark mb-1 block">New
                                Password</span>
                            <input type="text" id="admin-password-input" placeholder="Min 6 characters"
                                class="w-full rounded-lg bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 outline-none">
                        </label>
                        <button type="submit"
                            class="md:col-start-2 bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 rounded-lg transition-colors shadow-lg shadow-amber-500/20">
                            Update Credentials
                        </button>
                    </form>
                </section>

                <!-- Section 2: User Management -->
                <section>
                    <div
                        class="flex justify-between items-end mb-4 border-b border-border-light dark:border-border-dark pb-2">
                        <h4
                            class="text-sm font-bold uppercase tracking-wider text-text-muted-light dark:text-text-muted-dark">
                            User Management
                        </h4>
                        <span id="user-count-badge"
                            class="px-2 py-0.5 bg-slate-100 dark:bg-slate-800 text-xs font-mono rounded text-text-muted-light dark:text-text-muted-dark">0
                            Users</span>
                    </div>

                    <!-- Add User Form -->
                    <form onsubmit="event.preventDefault(); app.adminAddUser();"
                        class="flex gap-2 mb-4 p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-border-light dark:border-border-dark">
                        <input type="text" id="new-user-input" placeholder="Username to invite..."
                            class="flex-1 rounded-lg bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none">
                        <button type="submit"
                            class="bg-primary hover:bg-primary-dark text-white font-bold px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm">person_add</span>
                            Add
                        </button>
                    </form>

                    <!-- User List -->
                    <div class="border border-border-light dark:border-border-dark rounded-xl overflow-hidden">
                        <table class="w-full text-sm text-left">
                            <thead
                                class="bg-slate-50 dark:bg-slate-800 text-xs text-text-muted-light dark:text-text-muted-dark border-b border-border-light dark:border-border-dark">
                                <tr>
                                    <th class="px-4 py-3 font-semibold">Username</th>
                                    <th class="px-4 py-3 font-semibold">Status</th>
                                    <th class="px-4 py-3 text-right font-semibold">Action</th>
                                </tr>
                            </thead>
                            <tbody id="admin-user-list"
                                class="divide-y divide-border-light dark:divide-border-dark bg-surface-light dark:bg-surface-dark">
                                <!-- Dynamic Rows -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- CUSTOM CONFIRMATION MODAL -->
    <div id="modal-confirm"
        class="hidden fixed inset-0 z-[200] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4">
        <div
            class="bg-surface-light dark:bg-surface-dark w-full max-w-sm rounded-2xl shadow-2xl border border-border-light dark:border-border-dark p-6 transform scale-100 transition-all">
            <div class="flex flex-col items-center text-center space-y-4">
                <div class="p-3 bg-amber-500/10 rounded-full text-amber-500">
                    <span class="material-symbols-outlined text-3xl">warning</span>
                </div>
                <h3 class="text-lg font-black text-text-main-light dark:text-text-main-dark">Are you sure?</h3>
                <p id="confirm-message" class="text-sm text-text-muted-light dark:text-text-muted-dark">
                    This action cannot be undone.
                </p>
                <div class="grid grid-cols-2 gap-3 w-full mt-2">
                    <button id="btn-confirm-cancel"
                        class="py-2.5 rounded-xl font-bold text-sm text-text-muted-light dark:text-text-muted-dark hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                        Cancel
                    </button>
                    <button id="btn-confirm-action"
                        class="py-2.5 rounded-xl font-bold text-sm bg-loss text-white hover:bg-red-600 shadow-lg shadow-red-500/20 transition-all">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Logic -->
    <script>
        // Check for updates
        const VERSION = '1.1.0';
    </script>

    <!-- PROFILE MODAL -->
    <div id="modal-profile"
        class="hidden fixed inset-0 z-[200] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4">
        <div
            class="bg-surface-light dark:bg-surface-dark w-full max-w-md rounded-2xl shadow-2xl border border-border-light dark:border-border-dark flex flex-col overflow-hidden">
            <div
                class="px-6 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                <h3 class="text-lg font-black text-text-main-light dark:text-text-main-dark">My Profile</h3>
                <button onclick="document.getElementById('modal-profile').classList.add('hidden')"
                    class="p-2 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors material-symbols-outlined text-text-muted-light dark:text-text-muted-dark">close</button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label
                        class="text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase tracking-wider block mb-1">Username</label>
                    <input type="text" id="profile-username" disabled
                        class="w-full bg-slate-100 dark:bg-slate-800 text-text-muted-light dark:text-text-muted-dark px-4 py-3 rounded-xl border border-border-light dark:border-border-dark cursor-not-allowed">
                    <p class="text-[10px] text-text-muted-light dark:text-text-muted-dark mt-1">Username cannot be
                        changed.</p>
                </div>
                <div>
                    <label
                        class="text-xs font-bold text-text-muted-light dark:text-text-muted-dark uppercase tracking-wider block mb-1">Role</label>
                    <div id="profile-role"
                        class="inline-block px-3 py-1 bg-indigo-500/10 text-indigo-500 rounded-lg text-xs font-bold">
                        TRADER</div>
                </div>
                <div class="pt-4 border-t border-border-light dark:border-border-dark">
                    <h4 class="text-sm font-bold text-text-main-light dark:text-text-main-dark mb-3">Change Password
                    </h4>
                    <div class="space-y-3">
                        <input type="password" id="profile-password" placeholder="New Password"
                            class="w-full bg-background-light dark:bg-background-dark text-text-main-light dark:text-text-main-dark px-4 py-3 rounded-xl border border-border-light dark:border-border-dark focus:ring-2 focus:ring-indigo-500 outline-none">
                        <input type="password" id="profile-confirm-password" placeholder="Confirm New Password"
                            class="w-full bg-background-light dark:bg-background-dark text-text-main-light dark:text-text-main-dark px-4 py-3 rounded-xl border border-border-light dark:border-border-dark focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                </div>
                <button onclick="app.saveProfile()"
                    class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-indigo-500/20 transition-all active:scale-95 mt-2">
                    Update Profile
                </button>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Main Logic -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js" defer></script>
</body>

</html>